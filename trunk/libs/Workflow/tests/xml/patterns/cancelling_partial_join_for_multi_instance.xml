<?xml version="1.0" encoding="UTF-8"?> 
<process-definition name="flow" revision="1.0">
    <description>Pattern 35 (Cancelling Partial Join for Multiple Instances)</description>

    <!-- Start with an implicit simple split. -->
    <startactivity>
        <successor>add_instance_1</successor>
        <successor>multi_instance_1</successor>
    </startactivity>

    <!-- Branch 2 -->
        <!-- Split into 2 branches, and implicitly split twice in addition. -->
        <multiinstance name="multi_instance_1" times="2">
            <successor>activity_g1</successor>
            <successor>activity_g2</successor>
        </multiinstance>

        <!-- Parallel activities. -->
        <activity name="activity_g1">
            <successor>join_1</successor>
        </activity>
        <activity name="activity_g2">
            <successor>join_1</successor>
        </activity>

        <!-- Merge instances. -->
        <join name="join_1" context="multi_instance_1" threshold="4" cancel="1">
            <successor>join_2</successor>
        </join>
    <!-- End branch 2 -->

    <!-- Branch 1 -->
        <trigger name="add_instance_1" context="multi_instance_1">
            <successor>join_2</successor>
        </trigger>
    <!-- End branch 1 -->

    <!-- Join all branches. -->
    <join name="join_2">
        <successor>last</successor>
    </join>

    <!-- A final activity. -->
    <activity name="last">
        <successor>end</successor>
    </activity>
</process-definition>
