<?xml version="1.0" encoding="UTF-8"?> 
<process-definition name="flow" revision="1.0">
    <description>Pattern 37 (Acyclic Synchronizing Merge)</description>

    <startactivity>
        <successor>first</successor>
    </startactivity>
    
    <!-- Start with an implicit simple split. -->
    <activity name="first">
        <successor>activity_a1</successor>
        <successor>activity_b1</successor>
        <successor>activity_c1</successor>
    </activity>

    <!-- Implicit split. -->
    <activity name="activity_a1">
        <successor>join</successor>
    </activity>
    <activity name="activity_b1">
        <successor>join</successor>
    </activity>
    <activity name="activity_c1">
        <successor>loop_back_to_c1_once</successor>
    </activity>

    <!-- Loop back to c1 (once). -->
    <exclusivechoice name="loop_back_to_c1_once">
        <default-successor>activity_c1</default-successor>
        <conditional-successor>
            <equals left-field="loop_back_to_c1_once_reached" right-value="2" />
            <successor>activity_c2</successor>
        </conditional-successor>
    </exclusivechoice>

    <activity name="activity_c2">
        <successor>go_to_stub</successor>
    </activity>

    <!-- Choose the a path to a stubactivity. -->
    <exclusivechoice name="go_to_stub">
        <default-successor>activity_g1</default-successor>
        <conditional-successor>
            <equals left-value="1" right-value="1" />
            <successor>stub_1</successor>
        </conditional-successor>
    </exclusivechoice>

    <activity name="activity_g1">
        <successor>join</successor>
    </activity>

    <activity name="stub_1">
        <successor>loop_back_to_stub_1_once</successor>
    </activity>

    <!-- Loop back to g2 (once). -->
    <exclusivechoice name="loop_back_to_stub_1_once">
        <default-successor>stub_1</default-successor>
        <conditional-successor>
            <equals left-field="loop_back_to_stub_1_once_reached" right-value="2" />
            <successor>go_to_stub_3</successor>
        </conditional-successor>
    </exclusivechoice>

    <!-- Choose stub 3. -->
    <exclusivechoice name="go_to_stub_3">
        <default-successor>stub_2</default-successor>
        <conditional-successor>
            <equals left-value="1" right-value="1" />
            <successor>stub_3</successor>
        </conditional-successor>
    </exclusivechoice>

    <activity name="stub_2">
        <successor>foo</successor>
    </activity>

    <activity name="stub_3">
        <successor>foo</successor>
    </activity>

    <stubactivity name="foo" />

    <!-- Structured synchronizing merge. -->
    <join name="join" context="first">
        <successor>end</successor>
    </join>
</process-definition>
